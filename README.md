# １：ユースケース

サッカーチーム掲示板の基本的な要求。
* サッカーチームの試合結果に、ログインしたユーザーがコメントとイイねを付けることができる。
* ログインしていない人は閲覧のみができる。

具体的なユースケース（実際にシステムがユーザーに利用される際のやりとり）。
* 某月某日の試合結果に、Twitter／GitHub／Facebookアカウントを持っているユーザーがコメントを投稿。他投稿にイイねする。
* 個別試合ページをTwitterで拡散したりする。
など。
サービスの名前は、「予定調整くん」で、プロジェクト名は、schedule-arrangerとしましょう。
サービスの内容は、予定の出欠表があると思いますが、それを Web 上に表現したものがこの要求を満たすのに便利なものとなりそうです。

|      サービス名      | プロジェクト名 | アカウント名 |  サービス内容  |
| :------------------: | :------------: | :----------: | :------------: |
| 湘南ベルマーレ掲示板 |   Bell-Board   |  @bellboard  | コメント掲示板 |

# ２：要件定義／用語定義

## 【要件定義】

* 試合予定／結果が管理できる
* 試合結果に対してコメント／削除できる
* 「イイね」を付ける／外すことができる
* 管理人によってコメントを削除できる

以上のような要件は、機能要件とも呼ばれ、要求を満たすための機能があることを定義したものとなっています。
なお機能要件ではないもののことを非機能要件といいます。非機能要件には、機能に付随する性能に対する要件や、セキュリティに関する要件があります。
ここで非機能要件の定義は割愛します。

## 【用語定義】
|   用語   |  英語表記  |                 意味                 |
| :------: | :--------: | :----------------------------------: |
|  管理者  |   admin    |      試合情報とコメントの管理者      |
| ユーザー |    user    |          ログインした利用者          |
|   日程   |  fixture   |              試合の日程              |
| コメント |  comment   | 試合に対してユーザーがつけるコメント |
|   評価   | evaluation |      コメントに対する「イイね」      |

このような、システムの中に登場する用語と意味をしっかりと定義するということは、ソフトウェアづくりの中で非常に重要なことです。

これは、複数人でシステムを作るときに特に重要なのですが、
自分一人でプログラミングする場合においても、コードの中での言葉の表す対象の意味がぶれると思わぬ実装ミスを招いてしまいます。

そのようなミスを防ぐためにも、複雑なソフトウェアを作る際には、使う用語の定義を用語集やコードのコメント内にしっかりまとめておきましょう。

# ３：データモデリング
先ほど紹介した用語はすべて、データベース上におけるエンティティとみなして良いでしょう。

エンティティ同士の関係を表すと以下の ER 図のようになります。
わかりやすさを重視するために、概念スキーマという形で日本語で表記してあります。

![ER図](er.png "ER図")

主キーや外部キーなどの属性は全て省いて、エンティティ名だけで書いています。

中心となるエンティティは管理人とユーザーです。

管理人は、日程とユーザーそれぞれと「1 対 多」の関連を持っています。
ユーザーは、コメントと評価それぞれと「1 対 多」の関連を持っています。

* 管理人は、日程を作成／編集できる
* ユーザーはコメントを投稿／削除できる
* ユーザーはコメントへの評価の有無を操作できる
* 管理人は、ユーザーのコメントを削除する権限がある

以上の要件があるため、この関係は妥当だと言えます。
またこの関係から、コメント、評価はそれぞれ、ユーザーに従属しています。
しかし、日程とユーザーがそれぞれ管理人に従属していません。これは管理人による権限によって管理される関係なので、データを従属させる必要はないからです。

そのためこれらの関係を表す線には、 1 と 0 から N を表す 0..n が記載されています。この関係は「1 対 多」の関連における従属を表す ER 図の線の書き方です。

次に日程は、コメントと `「1 対 多」`の関連を持っています。これも、


* 日程には、ユーザーによってコメントが投稿できる
この要件を満たすために必要な要件であると言えます。
同様に、コメントは日程に従属しています。

そしてコメントは、評価と`「1 対 多」`の関連を持っています。

* コメントに対して、ユーザーは評価をできる
という要件があるためこれも必要でしょう。
同様に評価はコメントが存在しないとできないため、これも評価がコメントの従属エンティティだということができるでしょう。

さて、このようにデータモデルができたところで、先ほどの基本的な要件が満たされるのかを確認してみます。

* 試合予定／結果が管理できる
* 試合結果に対してコメント／削除できる
* 「イイね」を付ける／外すことができる
* 管理人によってコメントを削除できる

どうやらこのデータモデルで、管理人／ユーザーが上記の要件を実施することができそうです。
ではこのデータモデルで実装を行っていきましょう。

なお、このようにデータモデルなどの設計を行っていますが、実際に実装で都合が悪いところが出てきたら、それにあわせてデータモデルは変更していきます。
このような設計は、設計通りにしっかりと作ることが重要なのではなく、設計をすることによって、要件に漏れがないかや、根本的な仕組みに問題がないかをチェックすることが目的です。ですので、設計したら必ずこの通りに作らなくてはいけない、というわけではありません。このことに気をつけながら、設計を行っていきます。

# 4：URL設計
次に要件を満たすための URL 設計を行ってみましょう。

まずは内容を表示するページ構成を考えましょう。

* トップページ
* 自分が作った予定の一覧表示ページ
* 予定表示ページ
* 予定作成ページ
* 予定編集ページ
* 出欠表ページ
* コメントページ
思いつくままに上げてみました。
ログインとログアウトのページは省いています。

ただし、機能的に一緒であっても問題なさそうなページがありそうですので、まとめてみましょう。

* トップ/自分が作った予定の一覧表示ページ
* 予定表示/出欠表/コメントページ
* 予定作成ページ
* 予定編集ページ
このようにまとめられそうです。
トップページでは、自分が作った予定の一覧をログイン時とログアウト時で出し分けるように実装すればよさそうです。

予定の内容、出欠表、コメントは同じページ内にまとめて出欠やコメントの編集を AJAX を利用して編集するとより利便性があがります。

予定の作成と編集ページは、普通の HTML のフォームで実現できそうです。

これらを踏まえて、メソッドと URL のパス、内容をまとめると以下の表のようになります。

# 5ページのURL一覧
| パス  | メソッド | ページ内容 |
| --- | ---- | ----- |
|     |      |       |
|     |      |       |
|     |      |       |
|     |      |       |
|     |      |       |
|     |      |       |